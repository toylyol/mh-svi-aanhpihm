knitr::opts_chunk$set(echo = TRUE)
library(c("tidyverse","here"))
# List required packages ----
packages <- c("tidyverse", "here")
# Load all required packages
invisible( lapply(packages, library, character.only = TRUE) )
# Save base path to vector
path <- here()
covid_usafacts <- read_csv("/data/covid_confirmed_usafacts.csv")
path
covid_usafacts <- read_csv(here("data", "covid_confirmed_usafacts.csv"))
colnames(covid_usafacts)
covid_vars <- colnames(covid_usafacts)
View(covid_vars)
write.csv(covid_vars, "covid_vars.csv")
mh_svi_2018 <- read_csv( here("data", "mh_svi_county_2018.csv") )
colnames(mh_svi_2018)
pop_usafacts <- read+vsv(here("data", "covid_county_population_usafacts"))
pop_usafacts <- read_csv(here("data", "covid_county_population_usafacts"))
pop_usafacts <- read_csv(here("data", "covid_county_population_usafacts.csv"))
colnames(pop_usafacts)
compare_pop <- mh_svi_2018 %>%
select(ST_ABBR, COUNTY, FIPS) %>%
left_join(pop_usafacts, by = c("FIPS" = "CountyFIPS"))
compare_pop <- mh_svi_2018 %>%
select(ST_ABBR, COUNTY, FIPS) %>%
left_join(pop_usafacts, by = c("FIPS" = "countyFIPS"))
View(compare_pop)
compare_pop <- mh_svi_2018 %>%
select(ST_ABBR, COUNTY, FIPS, E_TOTPOP) %>%
left_join(pop_usafacts, by = c("FIPS" = "countyFIPS"))
# The following functions are courtesy of a Stats and R blog post: https://statsandr.com/blog/an-efficient-way-to-install-and-load-r-packages/
# List and load required packages ----
packages <- c("tidyverse", "here")
invisible( lapply(packages, library, character.only = TRUE) )
# Save base path to vector ----
path <- here()
# Load data ----
mh_svi_2018 <- read_csv( here("data", "mh_svi_county_2018.csv") )
covid_usafacts <- read_csv(here("data", "covid_confirmed_usafacts.csv")) # note chr vars: County Name, State, and StateFIP
pop_usafacts <- read_csv(here("data", "covid_county_population_usafacts.csv"))
?read_csv
View(covid_usafacts)
covid_usafacts %>%
select(last_col())
class(`2023-04-17`)
class(covid_usafacts$`2023-04-17`)
head(covid_usafacts)
all_covid_dates <- colnames(covid_usafacts) %>%
t()
View(all_covid_dates)
covid_usafacts %>%
filter( str_detect(`County Name`, "Miami") ) %>%
select(`County Name`, last_col())
pop_usafacts %>%
filter( str_detect(`County Name`, "Miami") )
1547142/2716940
Covid_cumul_cases <- covid_usafacts %>%
select( countyFIPS, `County Name`, State, StateFIPS, last_col() )
covid_cumul_cases <- covid_usafacts %>%
select( countyFIPS, `County Name`, State, StateFIPS, last_col() )
View(Covid_cumul_cases)
rm(Covid_cumul_cases, all_covid_dates)
View(covid_cumul_cases)
covid_missing_data <- covid_cumul_cases %>%
filter(`2023-04-17` == 0)
View(covid_missing_data)
covid_missing_data <- covid_cumul_cases %>%
filter(countyFIPS != 0) %>%
filter(`2023-04-17` == 0)
covid_missing_data
covid_missing_data$`County Name`[1]
colnames(mh_svi_2018)
covid_mh_svi_2018 <- mh_svi_2018 %>%
select(STATE, ST_ABBR, COUNTY, FIPS, E_TOTPOP, RPL_THEMES) %>%
left_join(covid_cumul_cases,
by = c("FIPS" = "countyFIPS"))
View(covid_mh_svi_2018)
View(pop_usafacts)
covid_mh_svi_2018 <- mh_svi_2018 %>%
select(STATE, ST_ABBR, COUNTY, FIPS, E_TOTPOP, RPL_THEMES) %>%
left_join(covid_cumul_cases,
by = c("FIPS" = "countyFIPS")) %>%
left_join(pop_usafacts,
by = "countyFIPS")
covid_mh_svi_2018 <- mh_svi_2018 %>%
select(STATE, ST_ABBR, COUNTY, FIPS, E_TOTPOP, RPL_THEMES) %>%
left_join(covid_cumul_cases,
by = c("FIPS" = "countyFIPS")) %>%
left_join(pop_usafacts,
by = c("FIPS" = "countyFIPS"))
covid_mh_svi_2018 <- mh_svi_2018 %>%
select(STATE, ST_ABBR, COUNTY, FIPS, E_TOTPOP, RPL_THEMES) %>%
left_join(covid_cumul_cases,
by = c("FIPS" = "countyFIPS")) %>%
left_join(pop_usafacts,
by = c("FIPS" = "countyFIPS")) %>%
select( !ends_with(".x") ) %>%
select( !ends_with(".y") ) %>%
select(-StateFIPS)
colnames(covid_mh_svi_2018)
max(covid_mh_svi_2018$population)
covid_mh_svi_2018  <- covid_mh_svi_2018 %>%
mutate(case_rate = `2023-04-17`/population) %>%
mutate(cases_per_100k = case_rate*100000)
covid_mh_svi_2018 %>%
filter(case_per_100k == 0 )
covid_mh_svi_2018 %>%
filter(cases_per_100k == 0)
covid_state_avg <- covid_mv_svi_2018 %>%
distinct(STATE, ST_ABBR)
covid_state_avg <- covid_mh_svi_2018 %>%
distinct(STATE, ST_ABBR)
View(covid_state_avg)
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_cases_per_100k = mean(cases_per_100k))
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE, ST) %>%
summarize(st_avg_cases_per_100k = mean(cases_per_100k))
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_cases_per_100k = mean(cases_per_100k)) %>%
scales::comma_format(accuracy = 0.01)
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_cases_per_100k = mean(cases_per_100k)) %>%
scales::comma_format(st_avg_cases_per_100k, accuracy = 0.01)
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_cases_per_100k = mean(cases_per_100k)) %>%
mutate(st_avg_cases_per_100k = scales::comma_format(st_avg_cases_per_100k,accuracy = 0.01))
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_cases_per_100k = mean(cases_per_100k)) %>%
mutate(st_avg_cases_per_100k = format(st_avg_cases_per_100k, big.mark = ","))
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES))
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES)) %>%
mutate( st_avg_per_100k = format(st_avg_per_100k, big.mark = ",") ) %>%
mutate( st_avg_svi = paste0(round(st_avg_svi*100,2),"%") ) %>%
rename(`State Average Cumulative COVID Case per 100,000 Population as of April 17, 2023` = st_avg_per_100k,
`State Average 2018 Overall Social Vulnerability Ranking` = st_avg_svi)
covid_state_avg %>%
ggplot() +
geom_point(x = st_avg_per_100k, y = st_avg_svi)
covid_state_avg %>%
ggplot() +
geom_point(aes(x = st_avg_per_100k, y = st_avg_svi))
covid_state_avg %>%
ggplot(aes(x = st_avg_per_100k, y = st_avg_svi)) +
geom_point() +
geom_point(alpha=0.5) +
scale_size()
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES)) %>%
mutate( st_avg_per_100k = format(st_avg_per_100k, big.mark = ",") ) %>%
mutate( st_avg_svi = paste0(round(st_avg_svi*100,2),"%") )
covid_state_avg %>%
ggplot(aes(x = st_avg_per_100k, y = st_avg_svi)) +
geom_point() +
geom_point(alpha=0.5) +
scale_size()
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES))
covid_state_avg %>%
ggplot(aes(x = st_avg_per_100k, y = st_avg_svi)) +
geom_point() +
geom_point(alpha=0.5) +
scale_size()
covid_mh_svi_2018 <- mh_svi_2018 %>%
select(STATE, ST_ABBR, COUNTY, FIPS, E_TOTPOP, RPL_THEMES) %>%
mutate(RPL_THEMES = ifelse(RPL_THEMES < 0, NA, RPL_THEMES)) %>%
left_join(covid_cumul_cases,
by = c("FIPS" = "countyFIPS")) %>%
left_join(pop_usafacts,
by = c("FIPS" = "countyFIPS")) %>%
select( !ends_with(".x") ) %>%
select( !ends_with(".y") ) %>%
select(-StateFIPS) %>%
mutate(case_rate = `2023-04-17`/population) %>%
mutate(cases_per_100k = case_rate*100000)
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES))
covid_state_avg %>%
ggplot(aes(x = st_avg_per_100k, y = st_avg_svi)) +
geom_point() +
geom_point(alpha=0.5) +
scale_size()
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES),
st_min_svi = min(RPL_THEMES),
st_max_svi = max(RPL_THEMES))
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k, na.rm = TRUE),
st_avg_svi = mean(RPL_THEMES),
st_min_svi = min(RPL_THEMES),
st_max_svi = max(RPL_THEMES))
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES, na.rm = TRUE),
st_min_svi = min(RPL_THEMES),
st_max_svi = max(RPL_THEMES))
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES, na.rm = TRUE),
st_min_svi = min(RPL_THEMES, na.rm = TRUE),
st_max_svi = max(RPL_THEMES, na.rm = TRUE))
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES, na.rm = TRUE),
st_min_svi = min(RPL_THEMES, na.rm = TRUE),
st_max_svi = max(RPL_THEMES, na.rm = TRUE)) %>%
mutate( st_avg_per_100k = format(st_avg_per_100k, big.mark = ",") ) %>%
mutate( st_avg_svi = paste0(round(st_avg_svi*100,2),"%") ) %>%
rename(`State Average Cumulative COVID Case per 100,000 Population as of April 17, 2023` = st_avg_per_100k,
`State Average 2018 Overall Social Vulnerability Ranking` = st_avg_svi,
`State Minimum 2018 Overall Social Vulnerability Ranking` = st_min_svi,
`State Maximum 2018 Overall Social Vulnerability Ranking` = st_max_svi)
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES, na.rm = TRUE),
st_min_svi = min(RPL_THEMES, na.rm = TRUE),
st_max_svi = max(RPL_THEMES, na.rm = TRUE)) %>%
mutate( st_avg_per_100k = format(st_avg_per_100k, big.mark = ",") ) %>%
mutate( across(!c(STATE, st_avg_per_100k)),
scales::label_percent(accuracy = 0.1,
suffix = "%") ) %>%
rename(`State Average Cumulative COVID Cases per 100,000 Population as of April 17, 2023` = st_avg_per_100k,
`State Average 2018 Overall Social Vulnerability Ranking` = st_avg_svi,
`State Minimum 2018 Overall Social Vulnerability Ranking` = st_min_svi,
`State Maximum 2018 Overall Social Vulnerability Ranking` = st_max_svi)
rlang::last_error()
rlang::last_trace()
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES, na.rm = TRUE),
st_min_svi = min(RPL_THEMES, na.rm = TRUE),
st_max_svi = max(RPL_THEMES, na.rm = TRUE)) %>%
mutate( st_avg_per_100k = format(st_avg_per_100k, big.mark = ",") ) %>%
mutate( across(!c(STATE, st_avg_per_100k)),
scales::label_percent(accuracy = 0.1,
suffix = "%") )
formatPercent <- function(df, x){
paste0(round(df$x * 100, 1), "%")
}
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES, na.rm = TRUE),
st_min_svi = min(RPL_THEMES, na.rm = TRUE),
st_max_svi = max(RPL_THEMES, na.rm = TRUE)) %>%
mutate( st_avg_per_100k = format(st_avg_per_100k, big.mark = ",") ) %>%
mutate( across(!c(STATE, st_avg_per_100k)),
formatPercent()) %>%
rename(`State Average Cumulative COVID Cases per 100,000 Population as of April 17, 2023` = st_avg_per_100k,
`State Average 2018 Overall Social Vulnerability Ranking` = st_avg_svi,
`State Minimum 2018 Overall Social Vulnerability Ranking` = st_min_svi,
`State Maximum 2018 Overall Social Vulnerability Ranking` = st_max_svi)
formatPercent <- function(x){
paste0(round(df$x * 100, 1), "%")
}
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES, na.rm = TRUE),
st_min_svi = min(RPL_THEMES, na.rm = TRUE),
st_max_svi = max(RPL_THEMES, na.rm = TRUE)) %>%
mutate( st_avg_per_100k = format(st_avg_per_100k, big.mark = ",") ) %>%
mutate( across(!c(STATE, st_avg_per_100k)),
formatPercent()) %>%
rename(`State Average Cumulative COVID Cases per 100,000 Population as of April 17, 2023` = st_avg_per_100k,
`State Average 2018 Overall Social Vulnerability Ranking` = st_avg_svi,
`State Minimum 2018 Overall Social Vulnerability Ranking` = st_min_svi,
`State Maximum 2018 Overall Social Vulnerability Ranking` = st_max_svi)
formatPercent <- function(x){
paste0(round(x * 100, 1), "%")
}
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES, na.rm = TRUE),
st_min_svi = min(RPL_THEMES, na.rm = TRUE),
st_max_svi = max(RPL_THEMES, na.rm = TRUE)) %>%
mutate( st_avg_per_100k = format(st_avg_per_100k, big.mark = ",") ) %>%
mutate( across(!c(STATE, st_avg_per_100k)),
formatPercent()) %>%
rename(`State Average Cumulative COVID Cases per 100,000 Population as of April 17, 2023` = st_avg_per_100k,
`State Average 2018 Overall Social Vulnerability Ranking` = st_avg_svi,
`State Minimum 2018 Overall Social Vulnerability Ranking` = st_min_svi,
`State Maximum 2018 Overall Social Vulnerability Ranking` = st_max_svi)
formatPercent <- function(x){
paste0(round(.data[x] * 100, 1), "%")
}
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES, na.rm = TRUE),
st_min_svi = min(RPL_THEMES, na.rm = TRUE),
st_max_svi = max(RPL_THEMES, na.rm = TRUE)) %>%
mutate( st_avg_per_100k = format(st_avg_per_100k, big.mark = ",") ) %>%
mutate( across(!c(STATE, st_avg_per_100k)),
formatPercent()) %>%
rename(`State Average Cumulative COVID Cases per 100,000 Population as of April 17, 2023` = st_avg_per_100k,
`State Average 2018 Overall Social Vulnerability Ranking` = st_avg_svi,
`State Minimum 2018 Overall Social Vulnerability Ranking` = st_min_svi,
`State Maximum 2018 Overall Social Vulnerability Ranking` = st_max_svi)
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES, na.rm = TRUE),
st_min_svi = min(RPL_THEMES, na.rm = TRUE),
st_max_svi = max(RPL_THEMES, na.rm = TRUE)) %>%
mutate( st_avg_per_100k = format(st_avg_per_100k, big.mark = ",") ) %>%
mutate( across(!c(STATE, st_avg_per_100k)),
formatPercent) %>%
rename(`State Average Cumulative COVID Cases per 100,000 Population as of April 17, 2023` = st_avg_per_100k,
`State Average 2018 Overall Social Vulnerability Ranking` = st_avg_svi,
`State Minimum 2018 Overall Social Vulnerability Ranking` = st_min_svi,
`State Maximum 2018 Overall Social Vulnerability Ranking` = st_max_svi)
covid_state_avg <- covid_mh_svi_2018 %>%
group_by(STATE) %>%
summarize(st_avg_per_100k = mean(cases_per_100k),
st_avg_svi = mean(RPL_THEMES, na.rm = TRUE),
st_min_svi = min(RPL_THEMES, na.rm = TRUE),
st_max_svi = max(RPL_THEMES, na.rm = TRUE)) %>%
mutate( st_avg_per_100k = format(st_avg_per_100k, big.mark = ",") ) %>%
mutate( across(!c(STATE, st_avg_per_100k),
scales::label_percent(accuracy = 0.1,
suffix = "%"))
) %>%
rename(`State Average Cumulative COVID Cases per 100,000 Population as of April 17, 2023` = st_avg_per_100k,
`State Average 2018 Overall Social Vulnerability Ranking` = st_avg_svi,
`State Minimum 2018 Overall Social Vulnerability Ranking` = st_min_svi,
`State Maximum 2018 Overall Social Vulnerability Ranking` = st_max_svi)
