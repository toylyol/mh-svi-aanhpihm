13+9+4+3
# List required packages ----
packages <- c("tidyverse", "openxlsx", "tigris", "here")
# Load all required packages
invisible( lapply(packages, library, character.only = TRUE) )
## Read in HI county-level data (ranking within state only)
hi_county <- read_csv(here("data", "Hawaii_COUNTY.csv"))
## Read in HI Census tract-level data (ranking within state only)
hi_tracts <- read_csv(here("data", "Hawaii"))
## Read in US Census tract-level data; filter to HI (ranking across all US)
us_tracts <- read_csv(here("data", "SVI2018_US.csv"))
hi_tracts <- read_csv(here("data", "Hawaii.csv"))
View(hi_county)
data_dic <- read_csv(here("data", "CDC_SVI_2018_DD"))
?read.xlsx
data_dic <- read.xlsx (here("data", "CDC_SVI_2018_DD.xlsx"), sheet = 1, startRow = 2)
View(data_dic)
hi_county %>%
select(LOCATION, RPL_THEMES)
colnames(hi_tracts)
hi_tracts %>%
select(COUNTY, LOCATION, RPL_THEMES)
hi_tracts %>%
select(COUNTY, LOCATION, RPL_THEMES) %>%
filter(RPL_THEMES >= 0.90)
View(
hi_tracts %>%
select(COUNTY, LOCATION, E_TOTPOP, RPL_THEMES) %>%
filter(RPL_THEMES >= 0.90)
)
shapefile_hi_tracts <- tracts("HI", cb = TRUE, year = 2018)
shapefile_hi_tracts
View(data_dic)
shapefile_hi_tracts <- shapefile_hi_tracts %>%
left_join(hi_tracts, by = c("TRACTCE" = "FIPS"))
class(shapefile_hi_tracts$TRACTCE)
class(hi_tracts$FIPS)
shapefile_hi_tracts <- shapefile_hi_tracts %>%
left_join(hi_tracts,
by = c("TRACTCE" = as.character("FIPS")))
hi_tracts$FIPS <- as.character(hi_tracts$FIPS)
shapefile_hi_tracts <- shapefile_hi_tracts %>%
left_join( hi_tracts, by = c("TRACTCE" = "FIPS") )
ggplot() +
geom_sf(data = shapefile_hi_tracts,
aes(fill = RPL_THEMES,
shape = "No data are available."),
size = 0.1) +
scale_fill_gradient(name = "Overall Minority Health Social Vulnerability Ranking\n",
low = "#2948a3",
high = "#2948a3",
labels = scales::percent_format(),
na.value = "gray97") +
scale_shape(guide = "legend") +                                   # use to ensure override.aes() accepted
guides(shape = guide_legend(title = NULL,                         # reinforce that there should be no legend title
override.aes = list(fill = "gray87",  # add NA value to legend
title = NULL,
label = FALSE,
order = 2,
color = "transparent")), # change stroke color in legend
fill = guide_colorbar(title.position = "top",                     # see https://r-graphics.org/recipe-legend-reverse
title.hjust = 0.5,
title.theme = element_text(size = 9,
color = "gray27"),
reverse = TRUE,
order = 1)
) +
theme_void() +
theme(legend.text = element_text(size = 9,                   # ensure that no-data message is gray font
color = "gray27"),
legend.position = "right",
legend.margin = margin(10, 10, 10, 10),                # remember clockwise order: top, right, bottom, left
plot.background = element_rect(fill = "transparent",
color = NA)
)
ggplot() +
geom_sf(data = shapefile_hi_tracts,
aes(fill = ifelse(RPL_THEMES > 0.90, 1, NA)),
size = 0.1) +
scale_fill_gradient(low = "#213a83",                     # specify the same HEX code for gradient
high = "#213a83",
na.value = "gray97") +
theme_void() +
theme(legend.position = "none",
plot.background = element_rect(fill = "transparent",   # ensure transparent bg upon saving
color = NA)
)
ggplot() +
geom_sf(data = shapefile_hi_tracts,
aes(fill = ifelse(RPL_THEMES >= 0.90, 1.1, NA)),
size = 0.1) +
scale_fill_gradient(low = "#213a83",                     # specify the same HEX code for gradient
high = "#213a83",
na.value = "gray97") +
theme_void() +
theme(legend.position = "none",
plot.background = element_rect(fill = "transparent",   # ensure transparent bg upon saving
color = NA)
)
ggplot() +
geom_sf(data = shapefile_hi_tracts,
aes(fill = ifelse(RPL_THEMES >= 0.90, RPL_THEMES, NA)),
size = 0.1) +
scale_fill_gradient(low = "#213a83",                     # specify the same HEX code for gradient
high = "#213a83",
na.value = "gray97") +
theme_void() +
theme(legend.position = "none",
plot.background = element_rect(fill = "transparent",   # ensure transparent bg upon saving
color = NA)
)
shapefile_hi_tracts$RPL_THEMES
home(hi_tract%RPL_THEMES)
home(hi_tract$RPL_THEMES)
head(hi_tract$RPL_THEMES)
head(hi_tracts$RPL_THEMES)
shapefile_hi_tracts <- shapefile_hi_tracts %>%
left_join( hi_tracts, by = c("TRACTCE" = "FIPS") )
shapefile_hi_tracts$RPL_THEMES
ggplot() +
geom_sf(data = shapefile_hi_tracts
)
colnames(us_tracts)
head(us_tracts$LOCATION)
head(us_tracts$COUNTY)
head(us_tracts$STCNTY)
us_tracts %>%
filter(ST_ABBR == "HI") %>%
select(STCNTY, COUNTY, LOCATION, RPL_THEMES) %>%
filter(RPL_THEMES >= 0.90)
ggplot() +
geom_sf(data = shapefile_hi_tracts) +
coord_sf(xlim = c(-162, -153), ylim = c(18, 23), expand = FALSE)
hi_mh_svi <- read_csv(here("data", "mh_svi_county_2018.csv")) %>%
filter(ST_ABBR == "HI") %>%
select(FIPS, COUNTY, RPL_THEMES)
hi_mh_svi
hi_county %>%
select(LOCATION, RPL_THEMES)
hi_tracts %>%
select(FIPS, COUNTY, LOCATION, E_TOTPOP, RPL_THEMES) %>%
filter(RPL_THEMES >= 0.90)
head(hi_tracts$TRACTCE)
head(us_tracts$TRACTCE)
head(shapefile_hi_tracts$TRACTCE)
View(shapefile_hi_tracts$TRACTCE)
colnames(shapefile_hi_tracts)
head(shapefile_hi_tracts$AFFGEOID)
head(shapefile_hi_tracts$NAME)
hi_county %>%
select(STCNTY, LOCATION, RPL_THEMES)
colnames(hi_county)
hi_county$FIPS
hi_tracts$FIPS
us_tracts$STCNTY
home(us_tracts$FIPS)
head(us_tracts$FIPS)
# Load 2018 Minority Health SVI data ----
hi_mh_svi <- read_csv(here("data", "mh_svi_county_2018.csv")) %>%
filter(ST_ABBR == "HI") %>%
select(FIPS, COUNTY, RPL_THEMES)
# Explore HI data in CDC/ATSDR SVI ----
## See county-level, within-HI rankings
hi_county_ranks <- hi_county %>%
select(FIPS, LOCATION, RPL_THEMES)
## See tract-level, within-HI rankings
hi_tract_ranks <- hi_tracts %>%
select(FIPS, COUNTY, LOCATION, E_TOTPOP, RPL_THEMES) %>%   # note 'FIPS' has tract IDs in tract-only data set
filter(RPL_THEMES >= 0.90)
## See tract-level, all-US rankings
hi_us_tract_ranks <- us_tracts %>%
filter(ST_ABBR == "HI") %>%
select(FIPS, COUNTY, LOCATION, RPL_THEMES) %>%
filter(RPL_THEMES >= 0.90)
compare_hi_county_ranks <- hi_mh_svi %>%
left_join(hi_county_ranks,
by = FIPS)
compare_hi_county_ranks <- hi_mh_svi %>%
left_join(hi_county_ranks,
by = "FIPS")
compare_hi_county_ranks
hi_county_ranks <- hi_county %>%
select(FIPS, LOCATION, RPL_THEMES) %>%
rename(MH_RPL_THEMES = RPL_THEMES)
compare_hi_county_ranks <- hi_mh_svi %>%
left_join(hi_county_ranks,
by = "FIPS")
compare_hi_county_ranks
hi_mh_svi <- read_csv(here("data", "mh_svi_county_2018.csv")) %>%
filter(ST_ABBR == "HI") %>%
select(FIPS, COUNTY, RPL_THEMES) %>%
rename(MH_RPL_THEMES = RPL_THEMES)
hi_county_ranks <- hi_county %>%
select(FIPS, LOCATION, RPL_THEMES)
compare_hi_county_ranks <- hi_mh_svi %>%
left_join(hi_county_ranks,
by = "FIPS")
compare_hi_county_ranks
compare_hi_county_ranks_table <- compare_hi_county_ranks %>%
select(-COUNTY) %>%
relocate(MH_RPL_THEMES, .after = LOCATION) %>%
rename(`County FIPS` = FIPS,
`Minority Health SVI Overall Social Vulnerability Ranking` = MH_RPL_THEMES,
`CDC/ATSDR SVI Overall Social Vulnerability Ranking` = RPL_THEMES)
compare_hi_county_ranks_table
compare_hi_county_ranks_table <- compare_hi_county_ranks %>%
select(-COUNTY) %>%
relocate(MH_RPL_THEMES, .after = LOCATION) %>%
mutate(across(c(MH_RPL_THEMES, RPL_THEMES),
scales::label_percent(accuracy = 0.1,
suffix = "%"))
) %>%
rename(`County FIPS` = FIPS,
`Minority Health SVI Overall Social Vulnerability Ranking` = MH_RPL_THEMES,
`CDC/ATSDR SVI Overall Social Vulnerability Ranking` = RPL_THEMES)
compare_hi_county_ranks_table
compare_hi_county_ranks %>%
select(-COUNTY) %>%
relocate(MH_RPL_THEMES, .after = LOCATION) %>%
mutate(across(c(MH_RPL_THEMES, RPL_THEMES),
scales::label_percent(accuracy = 0,
suffix = "%"))
) %>%
rename(`County FIPS` = FIPS,
`Minority Health SVI Overall Social Vulnerability Ranking` = MH_RPL_THEMES,
`CDC/ATSDR SVI Overall Social Vulnerability Ranking` = RPL_THEMES)
?scales::label_percent
compare_hi_county_ranks %>%
select(-COUNTY) %>%
relocate(MH_RPL_THEMES, .after = LOCATION) %>%
mutate(across(c(MH_RPL_THEMES, RPL_THEMES),
scales::label_percent(#accuracy = 0,
suffix = "%"))
) %>%
rename(`County FIPS` = FIPS,
`Minority Health SVI Overall Social Vulnerability Ranking` = MH_RPL_THEMES,
`CDC/ATSDR SVI Overall Social Vulnerability Ranking` = RPL_THEMES)
compare_hi_county_ranks %>%
select(-COUNTY) %>%
relocate(MH_RPL_THEMES, .after = LOCATION) %>%
mutate(across(c(MH_RPL_THEMES, RPL_THEMES),
scales::label_percent(accuracy = 1,
suffix = "%"))
) %>%
rename(`County FIPS` = FIPS,
`Minority Health SVI Overall Social Vulnerability Ranking` = MH_RPL_THEMES,
`CDC/ATSDR SVI Overall Social Vulnerability Ranking` = RPL_THEMES)
